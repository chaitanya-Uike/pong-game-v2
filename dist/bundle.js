(()=>{"use strict";var t=function(){function t(){this.magnitude=0,this.theta=0,this.x=0,this.y=0}return t.fromComponents=function(e,n){var o=new t;return o.x=e,o.y=n,o.magnitude=Math.sqrt(e*e+n*n),o.theta=Math.atan2(n,e),o},t.fromMagnitudeAndTheta=function(e,n){var o=new t;return o.magnitude=e,o.theta=n,o.x=e*Math.cos(n),o.y=e*Math.sin(n),o},t.prototype.getAngleBetween=function(t){var e=this.x*t.x+this.y*t.y,n=Math.sqrt(this.x*this.x+this.y*this.y)*Math.sqrt(t.x*t.x+t.y*t.y);return Math.acos(e/n)},t.prototype.getDistanceBetween=function(t){return this.subtract(t).magnitude},t.prototype.getNormalVector=function(){var e=new t;return e.magnitude=this.magnitude,e.theta=this.theta,e.x=this.x/this.magnitude,e.y=this.y/this.magnitude,e},t.prototype.add=function(e){var n=this.x+e.x,o=this.y+e.y;return t.fromComponents(n,o)},t.prototype.subtract=function(e){var n=this.x-e.x,o=this.y-e.y;return t.fromComponents(n,o)},t.prototype.scalerMultiply=function(e){return t.fromComponents(this.x*e,this.y*e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.getResultant=function(e){return t.fromComponents(this.x+e.x,this.y+e.y)},t.prototype.rotate=function(e){var n=this.x*Math.cos(e)-this.y*Math.sin(e),o=this.x*Math.sin(e)+this.y*Math.cos(e);return t.fromComponents(n,o)},t}();const e=t,n=function(t,n,o,i){this.position=e.fromComponents(t,n),this.ref=i,this.velocity=o,this.ref.style.position="absolute",this.ref.style.transformOrigin="center center"};function o(t){return t*Math.PI/180}function i(t){return 180*t/Math.PI}var r,s=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const a=function(t){function n(e,n,o,r,s,a){var l=this,c=document.createElement("div");return c.style.width=o+"px",c.style.height=r+"px",(l=t.call(this,e,n,a,c)||this).rotation=0,l.width=o,l.height=r,l.rotation=s,l.ref.style.transform="translate(".concat(l.position.x,"px, ").concat(l.position.y,"px) rotate(").concat(i(l.rotation),"deg)"),l}return s(n,t),n.prototype.updatePosition=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.ref.style.transform="translate(".concat(this.position.x,"px, ").concat(this.position.y,"px) rotate(").concat(i(this.rotation),"deg)")},n.prototype.getCenter=function(){var t=this.position.x+this.width/2,n=this.position.y+this.height/2;return e.fromComponents(t,n)},n}(n);var l=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const c=function(t){function n(e,n,o,i){var r=this,s=n-o,a=e-o,l=document.createElement("div");return l.style.width=2*o+"px",l.style.height=2*o+"px",(r=t.call(this,a,s,i,l)||this).radius=o,r.ref.style.transform="translate(".concat(r.position.x,"px, ").concat(r.position.y,"px)"),r}return l(n,t),n.prototype.getCenter=function(){var t=this.position.y,n=this.position.x;return e.fromComponents(n+this.radius,t+this.radius)},n.prototype.updatePosition=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.ref.style.transform="translate(".concat(this.position.x,"px, ").concat(this.position.y,"px)")},n}(n),h=function(){function t(){this.nullVelocity=new e}return t.prototype.getVelocityAfterCollision=function(t,n){var o,i=t instanceof a,r=t instanceof c,s=n instanceof c;return r&&n instanceof a?{velocity1:(o=this.handleSphereRectCollision(t,n)).sphereVelocity,velocity2:o.rectVelocity}:i&&s?{velocity1:(o=this.handleSphereRectCollision(n,t)).rectVelocity,velocity2:o.sphereVelocity}:r&&s?this.handleSpheresCollision(t,n):{velocity1:new e,velocity2:this.nullVelocity}},t.prototype.handleSphereRectCollision=function(t,e){var n=this.getCollisionNormal(t.getCenter().x,t.getCenter().y,e.position.x,e.position.y,e.width,e.height,e.rotation);return{sphereVelocity:this.bounce(n,t.velocity),rectVelocity:this.nullVelocity}},t.prototype.bounce=function(t,e){var n=t.scalerMultiply(-2*t.dot(e));return e.add(n)},t.prototype.getCollisionNormal=function(t,n,i,r,s,a,l){var c=s/2,h=a/2,y=i+c,p=r+h,u=Math.cos(l),f=Math.sin(l),d=Math.cos(l-o(90)),v=Math.sin(l-o(90)),g=t-y,x=n-p,m=g*u+x*f,b=g*d+x*v;m>c&&(m=c),m<-c&&(m=-c),b>h&&(b=h),b<-h&&(b=-h);var w=t-(y+m*u+b*d),C=n-(p+m*f+b*v),k=Math.sqrt(w*w+C*C);return 0===k?e.fromComponents(0,0):e.fromComponents(w/k,C/k)},t.prototype.handleSpheresCollision=function(t,n){var o=t.velocity.x-n.velocity.x,i=t.velocity.y-n.velocity.y;if(o*(n.getCenter().x-t.getCenter().x)+i*(n.getCenter().y-t.getCenter().y)>=0){var r=-Math.atan2(n.getCenter().y-t.getCenter().y,n.getCenter().x-t.getCenter().x),s=t.velocity.rotate(r),a=n.velocity.rotate(r),l=e.fromComponents(0*s.x/2+2*a.x*1/2,s.y),c=e.fromComponents(0*a.x/2+2*s.x*1/2,a.y);return{velocity1:l.rotate(-r),velocity2:c.rotate(-r)}}return{velocity1:t.velocity,velocity2:n.velocity}},t}(),y=function(){function t(){this.physicsEngine=new h,this.events=[]}return t.prototype.eventDispatcher=function(t){for(var e=0;e<t.length;e++)for(var n=function(n){var i=!1,r=t[e],s=t[n],l=r instanceof a,h=s instanceof a,y=r instanceof c,p=s instanceof c;if(l&&h)o.detectCollisionBetweenRects(r,s)&&(i=!0);else if(y&&p){if(o.detectCollisionBetweenSpheres(r,s)){i=!0;var u=o.physicsEngine.getVelocityAfterCollision(r,s);r.velocity=u.velocity1,s.velocity=u.velocity2}}else l&&p?o.detectCollisionBetweenRectAndSphere(r,s)&&(i=!0,u=o.physicsEngine.getVelocityAfterCollision(r,s),r.velocity=u.velocity1,s.velocity=u.velocity2):y&&h&&o.detectCollisionBetweenRectAndSphere(s,r)&&(i=!0,u=o.physicsEngine.getVelocityAfterCollision(r,s),r.velocity=u.velocity1,s.velocity=u.velocity2);if(i){var f=o.events.find((function(t){return t.entity1===r&&t.entity2===s||t.entity1===s&&t.entity2===r}));f&&f.handler()}},o=this,i=e+1;i<t.length;i++)n(i)},t.prototype.onCollision=function(t,e,n){this.events.push({entity1:t,entity2:e,handler:n})},t.prototype.off=function(t,e,n){var o=this.events.findIndex((function(o){return o.entity1===t&&o.entity2===e&&o.handler===n}));this.events.splice(o,1)},t.prototype.unsubscribe=function(){this.events=[]},t.prototype.detectCollisionBetweenRects=function(t,e){return t.position.x<e.position.x+e.width&&t.position.x+t.width>e.position.x&&t.position.y<e.position.y+e.height&&t.height+t.position.y>e.position.y},t.prototype.detectCollisionBetweenSpheres=function(t,e){return t.getCenter().getDistanceBetween(e.getCenter())<=t.radius+e.radius},t.prototype.detectCollisionBetweenRectAndSphere=function(t,e){var n,o,i=e.getCenter().x,r=e.getCenter().y,s=e.radius,a=t.position.x,l=t.position.y,c=t.getCenter().x,h=t.getCenter().y,y=Math.cos(t.rotation)*(i-c)-Math.sin(t.rotation)*(r-h)+c,p=Math.sin(t.rotation)*(i-c)+Math.cos(t.rotation)*(r-h)+h;return n=y<a?a:y>a+t.width?a+t.width:y,o=p<l?l:p>l+t.height?l+t.height:p,Math.sqrt((y-n)*(y-n)+(p-o)*(p-o))<=s},t}(),p=function(){function t(){var t=this;this.keyholdTable={},this.keyupTable={},document.addEventListener("keydown",(function(e){for(var n in t.keyholdTable[e.key]&&(t.keyholdTable[e.key].isHeld=!0),t.keyholdTable){var o=t.keyholdTable[n];o.isHeld&&o.handlers.forEach((function(t){return t()}))}})),document.addEventListener("keyup",(function(e){for(var n in t.keyholdTable[e.key]&&(t.keyholdTable[e.key].isHeld=!1),t.keyupTable)t.keyupTable[n].forEach((function(t){return t()}))}))}return t.prototype.on=function(t,e,n){"keydown"===t?(this.keyholdTable[e]||(this.keyholdTable[e]={isHeld:!1,handlers:[]}),this.keyholdTable[e].handlers.push(n)):"keyup"===t&&(this.keyupTable[e]||(this.keyupTable[e]=[]),this.keyupTable[e].push(n))},t.prototype.off=function(t,e,n){if("keydown"===t){if(!this.keyholdTable[e])return;var o=this.keyholdTable[e].handlers.findIndex((function(t){return t===n}));this.keyholdTable[e].handlers.splice(o,1),0===this.keyholdTable[e].handlers.length&&delete this.keyholdTable[e]}else if("keyup"===t){if(!this.keyupTable[e])return;o=this.keyupTable[e].findIndex((function(t){return t===n})),this.keyupTable[e].splice(o,1),0===this.keyupTable[e].length&&delete this.keyupTable[e]}},t.prototype.unsubscribe=function(){this.keyholdTable={},this.keyupTable={}},t}();var u;!function(t){t[t.playing=0]="playing",t[t.paused=1]="paused",t[t.over=2]="over",t[t.idle=3]="idle"}(u||(u={}));const f=function(){function t(t,e,n){this.entities=[],this.collisionManager=new y,this.keyboardManager=new p,this.state=u.idle,this.playAreaRef=document.querySelector(t),this.playAreaRef.style.width=e+"px",this.playAreaRef.style.height=n+"px",this.playAreaWidth=e,this.playAreaHeight=n,this.initialize()}return t.prototype.addEntity=function(t){var e=this;Array.isArray(t)?t.forEach((function(t){e.entities.push(t),e.playAreaRef.appendChild(t.ref)})):(this.entities.push(t),this.playAreaRef.appendChild(t.ref))},t.prototype.render=function(){this.state===u.playing&&(this.collisionManager.eventDispatcher(this.entities),this.entities.forEach((function(t){t.updatePosition()})),requestAnimationFrame(this.render.bind(this)))},t.prototype.play=function(){this.state!==u.playing&&(this.state=u.playing,this.render())},t.prototype.pause=function(){this.state=u.paused},t.prototype.stop=function(){this.state=u.over,this.onGameOver()},t.prototype.reset=function(){this.playAreaRef.innerHTML="",this.entities=[],this.collisionManager.unsubscribe(),this.keyboardManager.unsubscribe(),this.initialize()},t.prototype.onGameOver=function(){},t}();var d=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=function(t){function e(e,n,o,i){var r=t.call(this,e,n,o,i)||this;return r.ref.classList.add("ball"),r}return d(e,t),e}(c),g=function(t){function n(n,o,i,r,s){var a=t.call(this,n,o,i,r,s,new e)||this;return a.ref.classList.add("wall"),a}return d(n,t),n}(a),x=function(t){function n(n,o,i,r){var s=t.call(this,n,o,i,r,0,new e)||this;return s.ref.classList.add("paddle"),s}return d(n,t),n}(a),m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=document.querySelector(".play"),w=document.querySelector(".restart"),C=400,k=new(function(t){function n(){return t.call(this,".playArea",700,C)||this}return m(n,t),n.prototype.initialize=function(){var t=[45,-45,135,-135],n=Math.floor(Math.random()*t.length),i=e.fromMagnitudeAndTheta(3,o(t[n])),r=new v(348.5,195,10,i),s=new g(0,C,700,5,0),a=new g(500,200,C,5,o(90)),l=new g(0,-5,700,5,0),c=new g(-200,200,C,5,o(90)),h=new x(0,150,10,100),y=new x(690,150,10,100);this.addEntity(r),this.addEntity([s,a,l,c]),this.addEntity([h,y]);var p=document.createElement("div");p.classList.add("midLine"),this.playAreaRef.appendChild(p),this.addPaddleInteractions(h,"w","s"),this.addPaddleInteractions(y,"i","k"),this.stopFromgettingOutOfBounds(h,l,s),this.stopFromgettingOutOfBounds(y,l,s),this.handleGameOver(r,c,a)},n.prototype.addPaddleInteractions=function(t,n,o){var i=e.fromComponents(0,3),r=new e;this.keyboardManager.on("keydown",n,(function(){t.velocity=i.scalerMultiply(-1)})),this.keyboardManager.on("keyup",n,(function(){t.velocity=r})),this.keyboardManager.on("keydown",o,(function(){t.velocity=i})),this.keyboardManager.on("keyup",o,(function(){t.velocity=r}))},n.prototype.stopFromgettingOutOfBounds=function(t,e,n){var o=this;this.collisionManager.onCollision(t,e,(function(){t.position.y=0})),this.collisionManager.onCollision(t,n,(function(){t.position.y=o.playAreaHeight-t.height}))},n.prototype.handleGameOver=function(t,e,n){var o=this;this.collisionManager.onCollision(t,e,(function(){o.stop()})),this.collisionManager.onCollision(t,n,(function(){o.stop()}))},n}(f));b.onclick=function(){k.state===u.idle||k.state===u.paused?(k.play(),b.innerHTML="Pause",w.style.display="inline-block"):k.state===u.over?(k.reset(),k.play(),b.innerHTML="Pause",w.style.display="inline-block"):(k.pause(),b.innerHTML="Play",w.style.display="")},w.onclick=function(){k.reset()},k.onGameOver=function(){b.innerHTML="Restart",w.style.display=""}})();